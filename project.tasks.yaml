- _ulid: 01KH4DWQ6BNTGB4PE6PXKS1K24
  slugs:
    - port-design-doc
  title: Port design doc into kspec specs and tasks
  type: task
  description: Translate the ComfyUI node pack design document
    (~/Projects/merge-router/docs/comfyui-node-pack-design.md) into kspec spec items (modules,
    features, requirements with acceptance criteria) and derive implementation tasks. This should be
    done as a design session with review checkpoints — not all at once.
  spec_ref: null
  meta_ref: null
  plan_ref: null
  status: pending
  blocked_by: []
  depends_on: []
  context: []
  priority: 1
  tags:
    - setup
    - design
  vcs_refs: []
  created_at: 2026-02-10T18:44:18.251Z
  notes:
    - _ulid: 01KH4DZDER1NSMEDTPRYEWBNDB
      created_at: 2026-02-10T18:45:46.584Z
      author: "@claude"
      content: "Source document: ~/Projects/merge-router/docs/comfyui-node-pack-design.md (627+ lines, 8
        sections). Sections 6.8 (Exit Node Algorithm), 6.9 (Memory Strategy), and 6.10 (Per-Block
        Control) were written this session — they are complete but newer than the rest of the doc."
      supersedes: null
    - _ulid: 01KH4DZTRTJSRZ7CT7QCZT534V
      created_at: 2026-02-10T18:46:00.218Z
      author: "@claude"
      content: "Key design decisions already resolved (in §6.7 and §6.10): (1) Auto-detect architecture at
        Entry time from state dict keys. (2) Explicit backbone input on Merge node, defaults to
        base. (3) LoRA file selection via folder_paths.get_filename_list standard dropdown. (4) Exit
        node produces MODEL, saved via built-in ComfyUI save nodes. (5) Per-block control uses
        Option B — explicit BLOCK_CONFIG type wired into Merge (block_t_factor) and LoRA
        (block_strength) inputs. (6) One generic Block Config node per architecture (not two),
        semantics carried by input names on consumers. (7) Deferred execution — recipe nodes do zero
        GPU work, Exit runs full batched pipeline."
      supersedes: null
    - _ulid: 01KH4E058E4DY6405MKGBJHW08
      created_at: 2026-02-10T18:46:10.959Z
      author: "@claude"
      content: "Suggested module structure for specs: (1) nodes module — Entry, LoRA, Compose, Merge, Exit
        node specs with ACs for each. (2) core-algorithm module — WIDEN, divergence, ranking,
        numerical config (ported from merge-router). (3) executor module — batched pipeline,
        OpSignature grouping, GPU LoRA apply, OOM backoff. (4) lora-loading module —
        architecture-specific loaders (SDXL, Z-Image, Qwen), key mapping, QKV fusing. (5)
        block-config module — per-block control, architecture-specific Block Config nodes,
        BLOCK_CONFIG type."
      supersedes: null
    - _ulid: 01KH4E0DSSVM3M9YBBYY5G1207
      created_at: 2026-02-10T18:46:19.705Z
      author: "@claude"
      content: "User preference: this should be done as a design session with review checkpoints — present
        spec decomposition incrementally for approval, not all at once. Use /spec-plan workflow.
        Stub node files and recipe dataclasses already exist in the project (nodes/*.py,
        lib/recipe.py) which can inform AC writing."
      supersedes: null
    - _ulid: 01KH4E0P5Q1HW5AYXSWE0EQPWH
      created_at: 2026-02-10T18:46:28.279Z
      author: "@claude"
      content: "What NOT to port as specs: merge.py JSON config runner, CLI argument parsing, safetensors
        save logic, training infrastructure, Nu scripts. These are replaced by the ComfyUI node
        graph. The design doc §5 has the full port/no-port list."
      supersedes: null
    - _ulid: 01KH4E5KFNP2RN8144NKCXXWTM
      created_at: 2026-02-10T18:49:09.366Z
      author: "@claude"
      content: Design doc moved to docs/design.md in this project (copied from
        ~/Projects/merge-router/docs/comfyui-node-pack-design.md). References to merge-router source
        files now use full paths. Project structure section updated to comfy-ecaj-nodes/.
      supersedes: null
  todos: []
